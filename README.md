# face_detect
这个项目基于MFC图形库和OpenCV计算机视觉库实现了一个具有人脸检测功能和图形界面的显示屏控制程序，这个程序在未检测到人脸时会自动关闭显示器。进行人脸检测的代码位于“人脸检测息屏Dlg.cpp”文件中第23到第98行的FaceDetect线程函数中。
## 开发环境
1. 操作系统：Windows 10家庭中文版
2. 集成开发环境：Visual Studio Community 2015
3. 计算机视觉库：OpenCV 2.4.13
4. 命令行工具：NirCmd v2.81
## 功能设计
1. 点击“开始”按钮打开摄像头并且自动开启人脸检测自动控制屏幕开关；
2. 点击“锁定屏幕”或者“自动控制屏幕”执行相应的功能；
3. 点击“结束”按钮关闭视频窗口并且关闭人脸检测自动控制屏幕开关的功能；
4. 再次点击“开始”按钮再次开启人脸检测自动控制屏幕开关的功能；
5. 点击控制窗口右上角的叉关闭程序。
## 代码流程
1.	为保证视频处理以及屏幕控制的程序流畅运行，该程序选择将这部分代码写成一个独立的线程执行；
a)	使用CEvent类创建一个名为start_event的手动事件的全局对象；
b)	创建一个名为terminate_flag的全局变量，用于按钮的事件处理程序和执行线程之间的通信，利用该变量可以在“结束”按钮被按下的时候执行线程自动注销该线程；
c)	定义一个声明为DWORD WINAPI FaceDetect(LPVOID lpParam);的线程函数，该函数先打开摄像头并加载级联分类文件，然后再是一个用来获取并检测图像和控制屏幕的死循环，在死循环的开头接收信号并且判断是否应该结束该线程；
d)	当用户按下“开始”按钮时创建线程并且向线程发送信号；
e)	当用户按下“锁定屏幕”按钮时向线程发送ResetEvent的信号，并且将按钮显示的字符串改为“自动控制屏幕”，当用户按下“自动控制屏幕”按钮时向线程发送SetEvent信号；
f)	当用户按下“结束”按钮时将started_flag全局变量重置为0、将terminate_flag全局变量置-1，使线程结束自己。
2.	线程中人脸检测的流程：
a)	在线程函数的开始打开摄像头和级联分类文件；
b)	在死循环内从摄像头捕获图片，然后将图片的RGB类型转换为灰度类型，接着对图片进行直方图均衡化处理，然后将处理后的图片放入级联分类器函数中进行处理，并且返回人脸的边缘；
c)	在图片上绘制一个与边缘大小相同的圆，并且将其与图片一起显示出来；
d)	根据人脸的边缘大小调用WinExec("nircmd.exe monitor async_off", SW_HIDE); 或者WinExec("nircmd.exe monitor async_on", SW_HIDE); 来异步控制屏幕开关；
e)	死循环结束。